(function() {
  window.preview = function() {
    return $.ajax("/posts/preview", {
      type: 'POST',
      data: $('#post-change-form').serialize(),
      dataType: 'html',
      success: function(html) {
        $('#preview').html(html);
        return $('#preview-accordion').collapse('hide').collapse('show');
      },
      error: function(object, thing, text) {
        return $('#preview').html("<div class=\"alert alert-error\"> Preview failed.</div>");
      }
    });
  };

  window.add_show_more_links = function() {
    return $('.show-more-link').each(function() {
      var div, link_span;
      link_span = $(this);
      div = link_span.parent().children(".post-body");
      if (div.height() > (14 * 10)) {
        div.data("oldHeight", div.height());
        div.height(14 * 10);
        div.css("overflow", "hidden");
        link_span.html("<br><a href=\"javascript:void(0)\">Expand this post &rarr;</a><br>");
        return link_span.children("a").click(function(event) {
          div.height(div.data("oldHeight"));
          div.css("overflow", "visible");
          link_span.html("");
          e.preventDefault();
          return false;
        });
      }
    });
  };

  $(document).on("turbolinks:load", function() {
    return add_show_more_links();
  });

}).call(this);
