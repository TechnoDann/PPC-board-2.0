<%# Expects the ID of the current post, if any, to be passed in `id`.
    `bodies` causes the bodies of the posts to be displayed when true.
    Pass a hash generated by `.arrange`. `subthread` is internal-use
    only.  %>
<% subthread ||= false %>
<% for post, subthreads in thread do %>
  <% unless post.next_version %>
    <% unless subthread %>
      <div class="thread row-fluid">
    <% end %>
    <div class="post">
      <span class="<%= 'current-post' if post.id == id %>">
      <%= link_to post.subject, post %> by <%= post.author %> at <%= post.created_at %> 
      <span class="post-modifications">
        <%= "[LOCKED] " if post.locked %>
        <%= "[POOFED] " if post.poofed %>
        <%= "[EDITED] " if post.previous_version %>
      </span>
      </span>
      <% if bodies && !(!subthread && post.id == id) %>
        <% unless post.next_version %>
          <%= link_to 'Reply', new_post_path(:parent_id => @post) %> |
          <%= link_to 'Edit', edit_post_path(@post) %>
        <% end %>
      <br />
      <%= raw(markdown(post.body)) %>
      <% end %>
    </div>
    <div class="subthread">
      <%= render :partial => 'thread',
            :locals => { :bodies => bodies, :id => id, :subthread => true }, 
            :object => subthreads %>
    </div> 
    <% unless subthread %>
      </div>
    <% end %>
  <% end %>
<% end %>
